"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{70279:function(e,t,o){o.d(t,{makeImage:function(){return f}});var l=o(87290),n=o(98833),r=o(42382),i=o(27390),a=o(96764);let s={C:"G",G:"C",A:"T",T:"A"};async function f(e,t){var o;let{features:f,regions:c,bpPerPx:d,colorBy:h,displayCrossHatches:p,visibleModifications:b={},scaleOpts:y,height:u,theme:v,config:k,ticks:g,stopToken:m}=t,S=(0,n.createJBrowseTheme)(v),T=c[0],C=(T.end-T.start)/d,D=i.Rv,O=u-2*D,j={...y,range:[0,O]},M=(0,i.yZ)(j),w=(0,i.yZ)({...j,range:[0,O/2],scaleType:"linear"}),_=(0,i.P$)(y.scaleType),N=(0,i.P$)("linear"),P=(0,l.readConfObject)(k,"indicatorThreshold"),R=(0,l.readConfObject)(k,"showInterbaseCounts"),E=(0,l.readConfObject)(k,"showArcs"),x=(0,l.readConfObject)(k,"showInterbaseIndicators"),A=e=>O-(M(e)||0)+D,W=e=>A(_)-A(e),G=e=>O-(w(e)||0)+D,I=e=>G(N)-G(e),{bases:$,softclip:Z,hardclip:z,insertion:B}=S.palette,J={A:$.A.main,C:$.C.main,G:$.G.main,T:$.T.main,insertion:B,softclip:Z,hardclip:z,total:(0,l.readConfObject)(k,"color"),mod_NONE:"blue",cpg_meth:"red",cpg_unmeth:"blue"};e.fillStyle=J.total,(0,r.forEachWithStopTokenCheck)(f.values(),m,t=>{if("skip"===t.get("type"))return;let[o,l]=(0,r.featureSpanPx)(t,T,d),n=t.get("score");e.fillRect(o,A(n),l-o+.6,W(n))});let U=0,q=T.reversed?1/d:0,F="modifications"===h.type,H="methylation"===h.type,K=null===(o=h.modifications)||void 0===o?void 0:o.isolatedModification;if((0,r.forEachWithStopTokenCheck)(f.values(),m,t=>{var o,l,n,i,f,c,h,p,y;if("skip"===t.get("type"))return;let[u,v]=(0,r.featureSpanPx)(t,T,d),k=t.get("snpinfo"),g=Math.max(v-u,1),m=t.get("score");if(F){let t=0,r=null===(o=k.refbase)||void 0===o?void 0:o.toUpperCase(),{nonmods:d,mods:v,snps:S,ref:T}=k;for(let o of Object.keys(d).sort().reverse()){let c=b[o.replace("nonmod_","")]||b[o.replace("mod_","")];if(!c){console.warn(`${o} not known yet`);continue}if(K&&c.type!==K)continue;let d=s[c.base],h="N"===c.base?m:((null===(l=S[c.base])||void 0===l?void 0:l.entryDepth)||0)+((null===(n=S[d])||void 0===n?void 0:n.entryDepth)||0)+(r===c.base?T["1"]:0)+(r===d?T["-1"]:0),p="N"===c.base?m:((null===(i=S[c.base])||void 0===i?void 0:i.entryDepth)||0)+((null===(f=S[d])||void 0===f?void 0:f.entryDepth)||0)+(r===c.base?T.entryDepth:0)+(r===d?T.entryDepth:0),{entryDepth:y,avgProbability:v=0}=k.nonmods[o],C=p/m*(y/h),D=(0,a.pp)("blue",v),O=W(m),j=A(m)+O;e.fillStyle=D,e.fillRect(Math.round(u),j-(t+C*O),g,C*O),t+=C*O}for(let o of Object.keys(v).sort().reverse()){let l=b[o.replace("mod_","")];if(!l){console.warn(`${o} not known yet`);continue}if(K&&l.type!==K)continue;let n=s[l.base],i="N"===l.base?m:((null===(c=S[l.base])||void 0===c?void 0:c.entryDepth)||0)+((null===(h=S[n])||void 0===h?void 0:h.entryDepth)||0)+(r===l.base?T["1"]:0)+(r===n?T["-1"]:0),f="N"===l.base?m:((null===(p=S[l.base])||void 0===p?void 0:p.entryDepth)||0)+((null===(y=S[n])||void 0===y?void 0:y.entryDepth)||0)+(r===l.base?T.entryDepth:0)+(r===n?T.entryDepth:0),{entryDepth:d,avgProbability:k=0}=v[o],C=f/m*(d/i),D=l.color||"black",O=(0,a.pp)(D,k),j=W(m),M=A(m)+j;e.fillStyle=O,e.fillRect(Math.round(u),M-(t+C*j),g,C*j),t+=C*j}}else if(H){let{depth:t,nonmods:o,mods:l}=k,n=0;for(let o of Object.keys(l).sort().reverse()){let{entryDepth:r}=l[o],i=W(m),a=A(m)+i;e.fillStyle=J[o]||"black",e.fillRect(Math.round(u),a-(r+n)/t*i,g,r/t*i),n+=r}for(let l of Object.keys(o).sort().reverse()){let{entryDepth:r}=o[l],i=W(m),a=A(m)+i;e.fillStyle=J[l]||"black",e.fillRect(Math.round(u),a-(r+n)/t*i,g,r/t*i),n+=r}}else{let{depth:t,snps:o}=k,l=0;for(let n of Object.keys(o).sort().reverse()){let{entryDepth:r}=o[n],i=W(m),a=A(m)+i;e.fillStyle=J[n]||"black",e.fillRect(Math.round(u),a-(r+l)/t*i,g,r/t*i),l+=r}}let S=Object.keys(k.noncov);if(R){let t=0;for(let o of S){let{entryDepth:l}=k.noncov[o];e.fillStyle=J[o],e.fillRect(u-.6+q,4.5+I(t),1.2,I(l)),t+=l}}if(x){let t=0,o=0,l="";for(let e of S){let{entryDepth:n}=k.noncov[e];t+=n,n>o&&(o=n,l=e)}let n=Math.max(m,U);if(t>n*P&&n>7){e.fillStyle=J[l],e.beginPath();let t=u+q;e.moveTo(t-3.5,0),e.lineTo(t+3.5,0),e.lineTo(t,4.5),e.fill()}}U=m}),E&&(0,r.forEachWithStopTokenCheck)(f.values(),m,t=>{if("skip"!==t.get("type"))return;let o=t.get("start"),l=t.get("end"),[n,i]=(0,r.bpSpanPx)(o,l,T,d);e.beginPath();let a=t.get("effectiveStrand");1===a?e.strokeStyle="rgba(255,200,200,0.7)":-1===a?e.strokeStyle="rgba(200,200,255,0.7)":e.strokeStyle="rgba(200,200,200,0.7)",e.lineWidth=Math.log(t.get("score")+1),e.moveTo(n,O-2*D),e.bezierCurveTo(n,0,i,0,i,O-2*D),e.stroke()}),p)for(let t of(e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)",g.values))e.beginPath(),e.moveTo(0,Math.round(A(t))),e.lineTo(C,Math.round(A(t))),e.stroke()}}}]);