(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2530],{30311:function(e,s,a){Promise.resolve().then(a.bind(a,3682))},3682:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return T}});var t=a(57437),n=a(2265),i=a(8080),r=a(2645),c=a(36553),o=a(81436),l=a(25566);let d=l.env.NEXT_PUBLIC_API_URL||(window.location.hostname.includes("github.io")?"https://genome.crg.es/annotrieve":""),m=l.env.NEXT_PUBLIC_API_URL||(window.location.hostname.includes("github.io")?"https://genome.crg.es/annotrieve":""),u={theme:{palette:{mode:"dark",primary:{main:"#64748b",light:"#94a3b8",dark:"#475569",contrastText:"#ffffff"},secondary:{main:"#6b7280",light:"#9ca3af",dark:"#4b5563",contrastText:"#ffffff"},tertiary:{main:"#7c2d12",light:"#991b1b",dark:"#5c1a1a",contrastText:"#ffffff"},quaternary:{main:"#1e3a8a",light:"#1e40af",dark:"#1e293b",contrastText:"#ffffff"}}}};function x(e){let{accession:s,annotationId:l,selectedChromosome:x}=e,[f,h]=(0,n.useState)(),[p,g]=(0,n.useState)([]),[v,b]=(0,n.useState)([]),[j,N]=(0,n.useState)(""),[y,_]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=!1;return _(!0),async function(){try{var a,t,n,i;let[r,d]=await Promise.all([(0,c.TO)(s,0,100),(0,o.PR)({assembly_accessions:s,limit:100})]);if(e)return;let m=null!==(t=r.results)&&void 0!==t?t:[],u=null!==(n=d.results)&&void 0!==n?n:[];g(m),N(null!==(i=null===(a=u[0])||void 0===a?void 0:a.assembly_name)&&void 0!==i?i:""),l?b(u.filter(e=>e.annotation_id===l)):b(u)}catch(e){console.error("Error fetching JBrowse data:",e)}finally{e||_(!1)}}(),()=>{e=!0}},[s,l]);let w=(0,n.useMemo)(()=>v.map(e=>({type:"FeatureTrack",trackId:e.annotation_id,name:e.source_file_info.provider||"".concat(e.source_file_info.database," - ").concat(e.assembly_name),assemblyNames:[e.assembly_name],category:[e.source_file_info.database],adapter:{type:"Gff3TabixAdapter",gffGzLocation:{uri:"".concat(d,"/files/").concat(e.indexed_file_info.bgzipped_path),locationType:"UriLocation"},index:{location:{uri:"".concat(d,"/files/").concat(e.indexed_file_info.csi_path),locationType:"UriLocation"},indexType:"CSI"}},displays:[{type:"LinearBasicDisplay",displayId:"".concat(e.annotation_id,"_TrackDisplay"),renderer:{type:"SvgFeatureRenderer",showLabels:!0,showDescriptions:!0,labels:{descriptionColor:"#8b8b8b"}}}]})),[v]),k=(0,n.useMemo)(()=>Object.fromEntries(p.map(e=>["insdc:".concat(e.genbank_accession),{name:e.chr_name||e.ucsc_style_name||e.sequence_name,size:Number(e.length||0)}])),[p]),S=(0,n.useMemo)(()=>({name:j,refNameAliases:{adapter:{type:"RefNameAliasAdapter",location:{uri:"".concat(m,"/assemblies/").concat(s,"/chr_aliases"),locationType:"UriLocation"}}},sequence:{name:j,trackId:"".concat(s,"-seq"),type:"ReferenceSequenceTrack",adapter:{type:"RefGetAdapter",sequenceData:k}}}),[j,k,s]);return((0,n.useEffect)(()=>{if(!v.length||!p.length||!j||!w.length)return;let e=p[0],s=e?"".concat(e.chr_name||e.sequence_name,":1-").concat(Math.min(1e5,e.length)):void 0,t=w.map(e=>({type:"FeatureTrack",configuration:e.trackId,displays:[{type:"LinearBasicDisplay",configuration:"".concat(e.trackId,"_TrackDisplay")}]}));h((0,r.oQ)({assembly:S,tracks:w,plugins:[i.Z],configuration:{rpc:{defaultDriver:"WebWorkerRpcDriver"},...u},defaultSession:{name:"Annotrieve Session",view:{id:"linearGenomeView",type:"LinearGenomeView",...s&&e&&{displayedRegions:[{refName:e.chr_name||e.sequence_name,start:0,end:Math.min(1e5,e.length),assemblyName:j}]},tracks:t}},makeWorkerInstance:()=>new Worker(a.tu(new URL(a.p+a.u(4644),a.b)))}))},[S,w,p,j]),(0,n.useEffect)(()=>{if(f&&x&&j)try{f.session.view.navToLocString("".concat(x.chr_name,":1-").concat(Math.min(1e5,x.length)),j)}catch(e){console.error("Error navigating to chromosome:",e)}},[x,f,j]),y||!f)?(0,t.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:y?"Loading genome data...":"Initializing genome browser..."})]})}):(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(r.sK,{viewState:f})})}var f=a(45016),h=a(66070),p=a(35974),g=a(32660),v=a(56421),b=a(22135),j=a(40875),N=a(98420),y=a(31047),_=a(48736),w=a(41217),k=a(27648),S=a(62869);function L(){let[e,s]=(0,n.useState)(""),[a,i]=(0,n.useState)(""),[r,l]=(0,n.useState)(null),[d,m]=(0,n.useState)([]),[u,L]=(0,n.useState)(),[T,I]=(0,n.useState)(null),[C,E]=(0,n.useState)(!0),[R,Z]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{{let e=new URLSearchParams(window.location.search),a=e.get("accession"),t=e.get("annotationId");a&&s(a),t&&(i(t),L(t))}},[]),(0,n.useEffect)(()=>{(async function(){if(e)try{var s;Z(!0);let[a,t]=await Promise.all([(0,c.lP)(e),(0,o.PR)({assembly_accessions:e,limit:100})]);l(a),m(null!==(s=t.results)&&void 0!==s?s:[])}catch(e){console.error("Error fetching data:",e)}finally{Z(!1)}})()},[e]),e)?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b bg-card sticky top-0 z-10",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Genome Browser"}),(0,t.jsx)(k.default,{href:"/",children:(0,t.jsxs)(S.z,{variant:"ghost",size:"sm",className:"gap-2",children:[(0,t.jsx)(g.Z,{className:"h-4 w-4"}),"Back to Home"]})})]})})}),(0,t.jsxs)("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[(0,t.jsxs)(h.Zb,{className:"overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>E(!C),children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(v.Z,{className:"h-5 w-5 text-primary"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-foreground italic",children:R?"Loading...":(null==r?void 0:r.organism_name)||e}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e," • ",(null==r?void 0:r.assembly_name)||"Assembly"," • ",d.length," annotation",1!==d.length?"s":""]})]})]}),C?(0,t.jsx)(b.Z,{className:"h-5 w-5 text-muted-foreground"}):(0,t.jsx)(j.Z,{className:"h-5 w-5 text-muted-foreground"})]}),C&&!R&&r&&(0,t.jsxs)("div",{className:"border-t p-4 bg-muted/20",children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(N.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Submitter:"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:r.submitter})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(y.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Released:"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:r.release_date?new Date(r.release_date).toLocaleDateString():"N/A"})]})]})}),(0,t.jsxs)("div",{className:"space-y-3 pt-4 border-t",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-foreground",children:[(0,t.jsx)(v.Z,{className:"h-4 w-4"}),"Chromosomes:"]}),(0,t.jsx)(f.Y,{accession:e,onChromosomeSelected:e=>I(e),showDetails:!1})]}),d.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-foreground",children:[(0,t.jsx)(_.Z,{className:"h-4 w-4"}),"Available Annotations (",d.length,"):"]}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-3",children:d.map(e=>{var s,a,n,i,r,c,o,l,d;let m=null===(a=e.features_statistics)||void 0===a?void 0:null===(s=a.coding_genes)||void 0===s?void 0:s.count,x=null===(i=e.features_statistics)||void 0===i?void 0:null===(n=i.non_coding_genes)||void 0===n?void 0:n.count,f=null===(c=e.features_statistics)||void 0===c?void 0:null===(r=c.pseudogenes)||void 0===r?void 0:r.count;return(0,t.jsxs)("button",{onClick:()=>L(u===e.md5_checksum?void 0:e.md5_checksum),className:"p-4 rounded-lg border text-left transition-all ".concat(u===e.md5_checksum?"border-primary bg-primary/5 shadow-sm":"border-border hover:border-primary/50 hover:bg-muted/50"),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,t.jsx)(p.C,{variant:"secondary",className:"text-xs font-semibold",children:(null===(o=e.source_file_info)||void 0===o?void 0:o.database)||"Unknown"}),(0,t.jsx)(p.C,{variant:"accent",className:"text-xs",children:(null===(l=e.source_file_info)||void 0===l?void 0:l.provider)||"Unknown Provider"})]}),(null===(d=e.source_file_info)||void 0===d?void 0:d.release_date)&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground whitespace-nowrap",children:[(0,t.jsx)(y.Z,{className:"h-3 w-3"}),new Date(e.source_file_info.release_date).toLocaleDateString()]})]}),(void 0!==m||void 0!==x||void 0!==f)&&(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3 px-3 py-2 bg-accent/5 rounded-lg border border-accent/20",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[(0,t.jsx)(v.Z,{className:"h-3.5 w-3.5 text-accent"}),(0,t.jsx)("span",{className:"font-medium",children:"Genes:"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[void 0!==m&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Coding"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-foreground",children:m.toLocaleString()})]}),void 0!==x&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Non-coding"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-foreground",children:x.toLocaleString()})]}),void 0!==f&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Pseudo"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-foreground",children:f.toLocaleString()})]})]})]}),e.md5_checksum&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[(0,t.jsx)(w.Z,{className:"h-3 w-3"}),(0,t.jsxs)("span",{className:"font-mono",children:[e.md5_checksum.slice(0,16),"..."]})]})]},e.md5_checksum)})})]})]})]}),(0,t.jsx)(h.Zb,{className:"p-4",children:(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading genome browser..."})]})}),children:(0,t.jsx)(x,{accession:e,annotationId:u,selectedChromosome:T})})})]})]}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Invalid Accession"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"No assembly accession provided in URL parameters."}),(0,t.jsx)("a",{href:"/",className:"inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90",children:"← Back to Home"})]})})}function T(){return(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}),children:(0,t.jsx)(L,{})})}}},function(e){e.O(0,[3081,7492,5147,1544,8688,2726,8558,6629,1622,6889,4766,2971,2117,1744],function(){return e(e.s=30311)}),_N_E=e.O()}]);