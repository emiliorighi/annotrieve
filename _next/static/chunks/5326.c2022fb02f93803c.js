"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5326],{98239:function(e,t,r){r.d(t,{o:function(){return l}});function l(e,t){let r=0,l=0,o=0,n=[];for(let i=0;i<e.length&&o<t.length;i+=2){let a=+e[i],f=e[i+1];if("S"===f||"I"===f){for(let e=0;e<a&&o<t.length;e++)t[o]===r+e&&o++;r+=a}else if("D"===f||"N"===f)l+=a;else if("M"===f||"X"===f||"="===f){for(let e=0;e<a&&o<t.length;e++)t[o]===r+e&&(n.push({ref:l+e,idx:o}),o++);r+=a,l+=a}}return n}},85800:function(e,t,r){r.d(t,{b:function(){return a}});var l=r(98239),o=r(20687),n=r(99878),i=r(93755);function a(e,t){let r=e.get("start"),a=e.get("end"),f=e.get("strand"),s=a-r,c=(0,i.TN)(e,"MM","Mm")||"",u=[],_=[],d=[],p=[],h=e.get("seq");if(h){let r=(0,n.m)(e),i=(0,o.X)(c,h,f),a=0;for(let{type:e,positions:o}of i){for(let{ref:n,idx:i}of(0,l.o)(t,o)){if(n<0||n>=s)continue;let t=a+(-1===f?o.length-1-i:i),l=(null==r?void 0:r[t])||0;"m"===e?(u[n]=1,d[n]=l):"h"===e&&(_[n]=1,p[n]=l)}a+=o.length}}return{methBins:u,hydroxyMethBins:_,methProbs:d,hydroxyMethProbs:p}}},20687:function(e,t,r){r.d(t,{X:function(){return n}});var l=r(42382),o=r(66889);function n(e,t,r){let n=-1===r?(0,l.revcom)(t):t,i=e.split(";"),a=[];for(let e of i){if(""===e)continue;let t=e.split(","),l=t[0],i=o.R.exec(l);if(!i)throw Error(`bad format for MM tag: "${e}"`);let[,f,s,c]=i,u=c.split(/(\d+|.)/);for(let e of("-"===s&&(console.warn("unsupported negative strand modifications"),a.push({type:"unsupported",positions:[],base:f,strand:s})),u)){if(""===e)continue;let l=0,o=[];for(let e=1,i=t.length;e<i;e++){let i=+t[e];do("N"===f||f===n[l])&&i--,l++;while(i>=0&&l<n.length);if(-1===r){let e=n.length-l;e>=0&&o.unshift(e)}else o.push(l-1)}a.push({type:e,base:f,strand:s,positions:o})}}return a}},99878:function(e,t,r){r.d(t,{m:function(){return o}});var l=r(93755);function o(e){let t=(0,l.TN)(e,"ML","Ml")||[];if(t){let e=[];if("string"==typeof t){let r=t.split(",");for(let t=0,l=r.length;t<l;t++)e.push(+r[t]/255)}else for(let r=0,l=t.length;r<l;r++)e.push(t[r]/255);return e}{let t=(0,l.TN)(e,"MP","Mp");if(t){let e=[];for(let r=0,l=t.length;r<l;r++){let l=t.charCodeAt(r)-33;e.push(Math.min(1,l/50))}return e}return}}},65326:function(e,t,r){r.d(t,{makeImageData:function(){return g}});var l=r(87290),o=r(98833),n=r(42382),i=r(1698),a=r(93755),f=r(60288);function s(e,t,r,l,o,n,i){t+l<0||t>n||(i&&(e.fillStyle=i),e.fillRect(t,r,l,o))}function c(e){let{skip:t,deletion:r,insertion:l,hardclip:o,softclip:n,bases:i}=e.palette;return{A:i.A.main,C:i.C.main,G:i.G.main,T:i.T.main,deletion:r,insertion:l,hardclip:o,softclip:n,skip:t}}function u(){return{charWidth:(0,n.measureText)("A"),charHeight:(0,n.measureText)("M")-2}}var _=r(18228),d=r(96764),p=r(22216),h=r(85800);function g({ctx:e,layoutRecords:t,canvasWidth:r,renderArgs:g}){let{stopToken:m,config:b,showSoftClip:v,colorBy:T,theme:x}=g,C=(0,l.readConfObject)(b,"mismatchAlpha"),S=(0,l.readConfObject)(b,"minSubfeatureWidth"),M=(0,l.readConfObject)(b,"largeInsertionIndicatorScale"),w=(0,l.readConfObject)(b,"hideSmallIndels"),y="#f0f"===(0,l.readConfObject)(b,"color"),A=(0,o.createJBrowseTheme)(x),I=c(A),P=Object.fromEntries(Object.entries(c(A)).map(([e,t])=>[e,A.palette.getContrastText(t)]));e.font="bold 10px Courier New,monospace";let{charWidth:k,charHeight:N}=u(),R=["methylation","modifications"].includes((null==T?void 0:T.type)||"");(0,n.forEachWithStopTokenCheck)(t,m,t=>{!function({ctx:e,feat:t,renderArgs:r,colorMap:o,colorContrastMap:c,charWidth:u,charHeight:g,defaultColor:m,canvasWidth:b}){let{config:v,bpPerPx:T,regions:x,colorBy:C,colorTagMap:S={}}=r,{tag:M="",type:w=""}=C||{},{feature:y}=t,A=x[0];switch(e.fillStyle=function({colorType:e,tag:t,feature:r,config:o,defaultColor:n,colorTagMap:f}){switch(e){case"insertSize":return r.get("is_paired")&&r.get("refName")!==r.get("next_ref")?"#555":`hsl(${Math.abs(r.get("template_length"))/10},50%,50%)`;case"strand":return -1===r.get("strand")?"#8F8FD8":"#EC8B8B";case"mappingQuality":return`hsl(${r.get("score")},50%,50%)`;case"pairOrientation":return i.If[function(e,t){let r=(0,l.readConfObject)(t,"orientationType");return({LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"})[a.uD[r][e.get("pair_orientation")]]}(r,o)||"color_nostrand"];case"stranded":return i.If[function(e){let t=e.get("flags"),r=e.get("strand");if(1&t){let l=64&t?-1:1;return 2&t?r*l==1?"color_rev_strand":"color_fwd_strand":8&t?r*l==1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("refName")===e.get("next_ref")?r*l==1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return"color_unknown"}(r)];case"xs":case"tag":{let e=r.get("tags"),l=e?e[t]:r.get(t);if("XS"===t||"TS"===t){if("-"===l)return i.If.color_rev_strand;if("+"===l)return i.If.color_fwd_strand;return i.If.color_nostrand}if("ts"===t){if("-"===l)return -1===r.get("strand")?i.If.color_fwd_strand:i.If.color_rev_strand;if("+"===l)return -1===r.get("strand")?i.If.color_rev_strand:i.If.color_fwd_strand;return i.If.color_nostrand}return f[l]||i.If.color_nostrand}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":return 16&r.get("flags")?"#c8dcc8":"#c8c8c8";default:return n?"lightgrey":(0,l.readConfObject)(o,"color",{feature:r})}}({feature:y,config:v,tag:M,defaultColor:m,colorType:w,colorTagMap:S}),function({ctx:e,feat:t,renderArgs:r}){let{regions:l,bpPerPx:o}=r,{heightPx:i,topPx:a,feature:s}=t,c=l[0],u=s.get("start"),_=s.get("end"),d=s.get("CIGAR"),p=c.reversed?-1:1,h=s.get("strand")*p,g=o<10&&i>5;if(null==d?void 0:d.includes("N")){let t=(0,f.hs)(d);if(1===h){let r=0,l=u;for(let f=0;f<t.length;f+=2){let s=+t[f],u=t[f+1];if("M"===u||"X"===u||"="===u||"D"===u)r+=s;else if("N"===u){if(l!==r){let[t,f]=(0,n.bpSpanPx)(l,l+r,c,o),s=f-t;e.fillRect(t,a,s,i)}l+=r+s,r=0}}if(l!==r){let[t,f]=(0,n.bpSpanPx)(l,l+r,c,o),s=f-t;g?(e.beginPath(),e.moveTo(t,a),e.lineTo(t,a+i),e.lineTo(f,a+i),e.lineTo(f+5,a+i/2),e.lineTo(f,a),e.closePath(),e.fill()):e.fillRect(t,a,s,i)}}else if(-1===h){let r=0,l=_;for(let f=t.length-2;f>=0;f-=2){let s=+t[f],u=t[f+1];if("M"===u||"X"===u||"="===u||"D"===u)r+=s;else if("N"===u){if(0!==r){let[t,f]=(0,n.bpSpanPx)(l-r,l,c,o);e.fillRect(t,a,f-t,i)}l-=r+s,r=0}}if(0!==r){let[t,f]=(0,n.bpSpanPx)(l-r,l,c,o),s=f-t;g?(e.beginPath(),e.moveTo(t-5,a+i/2),e.lineTo(t,a+i),e.lineTo(f,a+i),e.lineTo(f,a),e.lineTo(t,a),e.closePath(),e.fill()):e.fillRect(t,a,s,i)}}}else{let[t,r]=(0,n.bpSpanPx)(u,_,c,o);o<10&&i>5?(-1===h?(e.beginPath(),e.moveTo(t-5,a+i/2),e.lineTo(t,a+i),e.lineTo(r,a+i),e.lineTo(r,a),e.lineTo(t,a)):(e.beginPath(),e.moveTo(t,a),e.lineTo(t,a+i),e.lineTo(r,a+i),e.lineTo(r+5,a+i/2),e.lineTo(r,a)),e.closePath(),e.fill()):e.fillRect(t,a,r-t,i)}}({ctx:e,feat:t,renderArgs:r}),w){case"perBaseQuality":!function({ctx:e,feat:t,region:r,bpPerPx:l,canvasWidth:o,cigarOps:i}){let{feature:a,topPx:f,heightPx:c}=t,u=(a.get("qual")||"").split(" ").map(e=>+e),_=1/l,d=a.get("start"),p=0,h=0;for(let t=0;t<i.length;t+=2){let a=+i[t],g=i[t+1];if("S"===g||"I"===g)p+=a;else if("D"===g||"N"===g)h+=a;else if("M"===g||"X"===g||"="===g){for(let t=0;t<a;t++){let i=u[p+t],a=d+h+t;s(e,(0,n.bpSpanPx)(a,a+1,r,l)[0],f,_+.5,c,o,`hsl(${255===i?150:1.5*i},55%,50%)`)}p+=a,h+=a}}}({ctx:e,feat:t,region:A,bpPerPx:T,canvasWidth:b,cigarOps:(0,f.hs)(y.get("CIGAR"))});break;case"perBaseLettering":!function({ctx:e,feat:t,region:r,bpPerPx:l,colorMap:o,colorContrastMap:i,charWidth:a,charHeight:f,canvasWidth:c,cigarOps:u}){let _=f-2,{feature:d,topPx:p,heightPx:h}=t,g=d.get("seq"),m=1/l,b=d.get("start"),v=0,T=0;if(g)for(let t=0;t<u.length;t+=2){let f=+u[t],d=u[t+1];if("S"===d||"I"===d)v+=f;else if("D"===d||"N"===d)T+=f;else if("M"===d||"X"===d||"="===d){for(let t=0;t<f;t++){let f=g[v+t],u=b+T+t,[d]=(0,n.bpSpanPx)(u,u+1,r,l);s(e,d,p,m+.5,h,c,o[f]),m>=a&&h>=_&&(e.fillStyle=i[f],e.fillText(f,d+(m-a)/2+1,p+h))}v+=f,T+=f}}}({ctx:e,feat:t,region:A,bpPerPx:T,colorMap:o,colorContrastMap:c,charWidth:u,charHeight:g,canvasWidth:b,cigarOps:(0,f.hs)(y.get("CIGAR"))});break;case"modifications":!function({ctx:e,feat:t,region:r,bpPerPx:l,renderArgs:o,canvasWidth:i,cigarOps:a}){var f,c,u;let{feature:p,topPx:h,heightPx:g}=t,{colorBy:m,visibleModifications:b={}}=o;if(!p.get("seq"))return;let v=p.get("start"),T=null===(f=null==m?void 0:m.modifications)||void 0===f?void 0:f.isolatedModification,x=null===(c=null==m?void 0:m.modifications)||void 0===c?void 0:c.twoColor;null===(u=(0,_.A)(p,a))||void 0===u||u.forEach(({allProbs:t,prob:o,type:a},f)=>{let c=v+f,[u,_]=(0,n.bpSpanPx)(c,c+1,r,l),p=b[a];if(!p){console.warn(`${a} not known yet`);return}if(T&&p.type!==T)return;let m=p.color||"black",C=1-(0,n.sum)(t);x&&C>(0,n.max)(t)?s(e,u,h,_-u+.5,g,i,(0,d.pp)("blue",C)):s(e,u,h,_-u+.5,g,i,(0,d.pp)(m,o)),f++})}({ctx:e,feat:t,region:A,bpPerPx:T,renderArgs:r,canvasWidth:b,cigarOps:(0,f.hs)(y.get("CIGAR"))});break;case"methylation":!function({ctx:e,feat:t,region:r,bpPerPx:l,renderArgs:o,canvasWidth:i,cigarOps:a}){let{regionSequence:f}=o,{feature:c,topPx:u,heightPx:_}=t;if(!f)throw Error("region sequence required for methylation");if(!c.get("seq"))return;let d=c.get("start"),g=c.get("end"),{methBins:m,methProbs:b,hydroxyMethBins:v,hydroxyMethProbs:T}=(0,h.b)(c,a);function x(e){if(m[e]){let t=b[e]||0;return(t>.5?(0,p.colord)("red").alpha((t-.5)*2):(0,p.colord)("blue").alpha(1-2*t)).toHslString()}if(v[e]){let t=T[e]||0;return(t>.5?(0,p.colord)("pink").alpha((t-.5)*2):(0,p.colord)("purple").alpha(1-2*t)).toHslString()}}let C=f.toLowerCase();for(let t=0;t<g-d;t++){let o=t+d,a=C[o-r.start+1],f=C[o-r.start+2];if("c"===a&&"g"===f){if(l>2){let[a,f]=(0,n.bpSpanPx)(o,o+2,r,l),c=f-a+.5;s(e,a,u,c,_,i,x(t)||x(t+1)||"blue")}else{let[a,f]=(0,n.bpSpanPx)(o,o+1,r,l),c=f-a+.5;s(e,a,u,c,_,i,x(t)||"blue");let[d,p]=(0,n.bpSpanPx)(o+1,o+2,r,l),h=p-d+.5;s(e,d,u,h,_,i,x(t+1)||"blue")}}}}({ctx:e,feat:t,region:A,bpPerPx:T,renderArgs:r,canvasWidth:b,cigarOps:(0,f.hs)(y.get("CIGAR"))})}}({ctx:e,feat:t,renderArgs:g,defaultColor:y,colorMap:I,colorContrastMap:P,charWidth:k,charHeight:N,canvasWidth:r}),function({ctx:e,feat:t,renderArgs:r,minSubfeatureWidth:l,largeInsertionIndicatorScale:o,mismatchAlpha:i,charWidth:a,charHeight:f,colorMap:c,colorContrastMap:u,hideSmallIndels:_,canvasWidth:d,drawSNPsMuted:h,drawIndels:g=!0}){let{bpPerPx:m,regions:b}=r,{heightPx:v,topPx:T,feature:x}=t,C=b[0],S=x.get("start"),M=Math.min(1/m,2),w=x.get("mismatches"),y=f-2,A=C.reversed?1/m+1:-1;if(w){for(let t of w){let r=S+t.start,o=t.length,f=t.base,[b,x]=(0,n.bpSpanPx)(r,r+o,C,m),w=Math.max(l,x-b);if("mismatch"===t.type){if(!h){let r=c[t.base]||"#888";s(e,Math.round(b),T,w,v,d,i&&void 0!==t.qual?(0,p.colord)(r).alpha(Math.min(1,t.qual/50)).toHslString():r)}if(w>=a&&v>=y){let r=h?"black":u[t.base]||"black";e.fillStyle=i&&void 0!==t.qual?(0,p.colord)(r).alpha(Math.min(1,t.qual/50)).toHslString():r,e.fillText(f,b+(w-a)/2+1,T+v)}}else if("deletion"===t.type&&g){let r=t.length;if(!_||r>=10){s(e,b,T,Math.abs(b-x),v,d,c.deletion);let r=`${t.length}`,l=(0,n.measureText)(r,10);w>=l&&v>=y&&(e.fillStyle=u.deletion,e.fillText(r,(b+x)/2-l/2,T+v))}}else if("insertion"===t.type&&g){let r=b+A,l=+t.base||t.length,o=Math.max(0,Math.min(1.2,1/m));if(l<10&&!_&&(s(e,r,T,o,v,d,c.insertion),1/m>=a&&v>=y)){let l=Math.round(r-o);s(e,l,T,3*o,1,d),s(e,l,T+v-1,3*o,1,d),e.fillText(`(${t.base})`,r+3,T+v)}}else if("hardclip"===t.type||"softclip"===t.type){let r=b+A,o=c[t.type],n=Math.max(l,M);if(s(e,r,T,n,v,d,o),1/m>=a&&v>=y){let l=r-n;s(e,l,T,3*n,1,d),s(e,l,T+v-1,3*n,1,d),e.fillText(`(${t.base})`,r+3,T+v)}}else"skip"===t.type&&b+w>0&&s(e,Math.max(0,b),T+v/2-1,w-(m>10?1.5:0)+Math.min(b,0),1,d,c.skip)}if(g)for(let t of w){let r=S+t.start,l=t.length,i=+t.base||t.length;if("insertion"===t.type&&i>=10){let[t]=(0,n.bpSpanPx)(r,r+l,C,m),a=`${i}`;if(m>o)s(e,t-1,T,2,v,d,c.insertion);else if(v>f){let r=(0,n.measureText)(a);s(e,t-r/2-5,T,r+10,v,d,"purple"),e.fillStyle=u.insertion,e.fillText(a,t-r/2,T+v)}else s(e,t-2,T,4,v,d,c.insertion)}}}}({ctx:e,feat:t,renderArgs:g,hideSmallIndels:w,mismatchAlpha:C,drawSNPsMuted:R,drawIndels:!0,largeInsertionIndicatorScale:M,minSubfeatureWidth:S,charWidth:k,charHeight:N,colorMap:I,colorContrastMap:P,canvasWidth:r}),v&&function({ctx:e,feat:t,renderArgs:r,config:o,theme:i,colorMap:a,canvasWidth:c}){let{feature:_,topPx:d,heightPx:p}=t,{regions:h,bpPerPx:g}=r,m=h[0],b=(0,l.readConfObject)(o,"minSubfeatureWidth"),v=_.get("mismatches"),T=_.get("seq"),{charWidth:x,charHeight:C}=u();if(!(T&&v))return;let S=C-2,M=0,w=0,y=_.get("CIGAR"),A=(0,f.hs)(y);for(let t=0;t<A.length;t+=2){let r=A[t+1],l=+A[t];if("S"===r){for(let r=0;r<l;r++){let o=T[M+r],f=_.get("start")-(0===t?l:0)+w+r,[u,h]=(0,n.bpSpanPx)(f,f+1,m,g),v=Math.max(b,h-u),C=a[o]||"#000000";e.fillStyle=C,s(e,u,d,v,p,c),v>=x&&p>=S&&(e.fillStyle=i.palette.getContrastText(C),e.fillText(o,u+(v-x)/2+1,d+p))}M+=l}"N"===r&&(w+=l),("M"===r||"="===r||"X"===r)&&(w+=l,M+=l),"D"===r&&(w+=l),"I"===r&&(M+=l)}}({ctx:e,feat:t,renderArgs:g,colorMap:I,config:b,theme:A,canvasWidth:r})})}},1698:function(e,t,r){r.d(t,{If:function(){return o},Wh:function(){return i},k5:function(){return f},uE:function(){return c},ue:function(){return n}});var l=r(93755);let o={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"purple",color_longinsert:"red",color_shortinsert:"pink",color_unknown:"grey"},n={color_fwd_strand_not_proper:"#CA6767",color_rev_strand_not_proper:"#7272AA",color_fwd_strand:"#DC2A2A",color_rev_strand:"#4141BA",color_fwd_missing_mate:"#921111",color_rev_missing_mate:"#111192",color_fwd_diff_chr:"#000000",color_rev_diff_chr:"#696969",color_pair_lr:"#8C8C8C",color_pair_rr:"#00005A",color_pair_rl:"#005A5A",color_pair_ll:"#005A00",color_nostrand:"#8C8C8C",color_interchrom:"#5A005A",color_longinsert:"#B30000",color_shortinsert:"#FF3A5C",color_unknown:"grey"};function i(e,t,r){let l=e.refName===t.refName,i=Math.abs(e.tlen||0);return l&&i>((null==r?void 0:r.upper)||0)?[o.color_longinsert,n.color_longinsert]:l&&i<((null==r?void 0:r.lower)||0)?[o.color_shortinsert,n.color_shortinsert]:l?void 0:[o.color_interchrom,n.color_interchrom]}let a=[o.color_unknown,o.color_unknown];function f(e,t,r){return s(e)||i(e,t,r)||a}function s(e){let t=l.uD.fr[e.pair_orientation||""],r=l.oL[t];return"LR"===t?void 0:[o[r],n[r]]}function c(e){return s(e)||a}},18228:function(e,t,r){r.d(t,{A:function(){return f}});var l=r(60288),o=r(98239),n=r(20687),i=r(99878),a=r(93755);function f(e,t){let r=e.get("strand"),f=e.get("seq"),s=(0,a.TN)(e,"MM","Mm")||"",c=t||(0,l.hs)(e.get("CIGAR"));if(f){let t=(0,n.X)(s,f,r),l=(0,i.m)(e),a=[],u=0;for(let{type:e,positions:n}of t){for(let{ref:t,idx:i}of(0,o.o)(c,n)){let o=(null==l?void 0:l[u+(-1===r?n.length-1-i:i)])||0;if(a[t]){let r=a[t];a[t]={allProbs:[...r.allProbs,o],prob:Math.max(r.prob,o),type:r.prob>o?r.type:e}}else a[t]={type:e,prob:o,allProbs:[o]}}u+=n.length}return a}}}}]);