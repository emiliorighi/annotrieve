"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4791],{5835:function(e,t,a){t.W=function(e,t,a=()=>{}){let s=new TextDecoder("utf8"),n=0,i=0;for(;n<e.length;){let l=e.indexOf(10,n),o=-1===l?e.length:l,u=e.subarray(n,o),h=s.decode(u).trim();if(h&&!1===t(h,i))break;i++%1e4==0&&a(`Loading ${(0,r.getProgressDisplayStr)(n,e.length)}`),n=o+1}};let r=a(42382)},74791:function(e,t,a){a.r(t);var r=a(29707),s=a(33224),n=a(77207),i=a(42382),l=a(61795),o=a(5835),u=a(52427),h=a(91666);class c extends n.BaseFeatureDataAdapter{constructor(){super(...arguments),this.intervalTrees={}}async loadDataP(e){let t=this.getConf("bedLocation"),a=await (0,i.fetchAndMaybeUnzip)((0,l.openLocation)(t,this.pluginManager),e),r=[],n={};(0,o.W)(a,e=>{if(e.startsWith("#"))r.push(e);else{let t=e.indexOf("	"),a=e.slice(0,t);n[a]||(n[a]=[]),n[a].push(e)}return!0},null==e?void 0:e.statusCallback);let u=r.join("\n"),h=this.getConf("autoSql"),c=new s.Z({autoSql:h}),d=this.getConf("columnNames"),f=this.getConf("scoreColumn");return{header:u,features:n,parser:c,columnNames:d,scoreColumn:f,colRef:this.getConf("colRef"),colStart:this.getConf("colStart"),colEnd:this.getConf("colEnd")}}async loadData(e={}){return this.bedFeatures||(this.bedFeatures=this.loadDataP(e).catch(e=>{throw this.bedFeatures=void 0,e})),this.bedFeatures}async getRefNames(e={}){let{features:t}=await this.loadData(e);return Object.keys(t)}async getHeader(e={}){let{header:t}=await this.loadData(e);return t}async getNames(){let{header:e,columnNames:t}=await this.loadData();if(t.length)return t;let a=e.split(/\n|\r\n|\r/).filter(e=>!!e).at(-1);return(null==a?void 0:a.includes("	"))?a.slice(1).split("	").map(e=>e.trim()):void 0}async loadFeatureIntervalTreeHelper(e){let{colRef:t,colStart:a,colEnd:s,features:n,parser:l,scoreColumn:o}=await this.loadData(),u=n[e];if(!u)return;let c=await this.getNames(),d=new r.ZP;for(let r=0;r<u.length;r++){let n=u[r],f=`${this.id}-${e}-${r}`,g=new i.SimpleFeature((0,h.PT)({line:n,colRef:t,colStart:a,colEnd:s,scoreColumn:o,parser:l,uniqueId:f,names:c}));d.insert([g.get("start"),g.get("end")],g)}return d}async loadFeatureIntervalTree(e){return this.intervalTrees[e]||(this.intervalTrees[e]=this.loadFeatureIntervalTreeHelper(e).catch(t=>{throw this.intervalTrees[e]=void 0,t})),this.intervalTrees[e]}getFeatures(e,t={}){return(0,u.ObservableCreate)(async t=>{let{start:a,end:r,refName:s}=e,n=await this.loadFeatureIntervalTree(s),i=null==n?void 0:n.search([a,r]);if(i)for(let e of i)t.next(e);t.complete()},t.stopToken)}}c.capabilities=["getFeatures","getRefNames"],t.default=c}}]);