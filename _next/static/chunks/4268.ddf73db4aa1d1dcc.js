"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4268],{74268:function(e,t,r){r.r(t),r.d(t,{default:function(){return u}});var n=r(93900),a=r(24295),s=r(77207),i=r(42382),o=r(47858),l=r(61795),c=r(52427),h=r(47368);class u extends s.BaseSequenceAdapter{constructor(){super(...arguments),this.seqCache=new n.Z({cache:new o.default({maxSize:200}),fill:async e=>{let{refName:t,start:r,end:n,fasta:a}=e;return a.getSequence(t,r,n)}})}async getRefNames(e){let{fasta:t}=await this.setup();return t.getSequenceNames()}async getRegions(e){let{fasta:t}=await this.setup(),r=await t.getSequenceSizes();return Object.keys(r).map(e=>({refName:e,start:0,end:r[e]}))}async setupPre(){let e=this.getConf("fastaLocation"),t=this.getConf("faiLocation");return{fasta:new a.P({fasta:(0,l.openLocation)(e,this.pluginManager),fai:(0,l.openLocation)(t,this.pluginManager)})}}async getHeader(){let e=this.getConf("metadataLocation");return""===e.uri||"/path/to/fa.metadata.yaml"===e.uri?null:(0,l.openLocation)(e,this.pluginManager).readFile("utf8")}async setup(){return this.setupP||(this.setupP=this.setupPre().catch(e=>{throw this.setupP=void 0,e})),this.setupP}getFeatures(e,t){let{statusCallback:r=()=>{},stopToken:n}=t||{},{refName:a,start:s,end:o}=e;return(0,c.ObservableCreate)(async e=>{await (0,i.updateStatus2)("Downloading sequence",r,n,async()=>{let{fasta:t}=await this.setup(),r=Math.min(await t.getSequenceSize(a)||0,o),l=[],c=s-s%128e3,u=o+(128e3-o%128e3);for(let e=c;e<u;e+=128e3){let r={refName:a,start:e,end:e+128e3};(0,h.checkStopToken)(n);let s=await this.seqCache.get(JSON.stringify(r),{...r,fasta:t});if(!s)break;l.push(s)}let d=l.filter(e=>!!e).join("").slice(s-c).slice(0,o-s);d&&e.next(new i.SimpleFeature({id:`${a}-${s}-${r}`,data:{refName:a,start:s,end:r,seq:d}}))}),e.complete()})}}},93900:function(e,t,r){r.d(t,{Z:function(){return i}});class n{}class a{constructor(){this.signals=new Set,this.abortController=new AbortController}addSignal(e=new n){if(this.signal.aborted)throw Error("cannot add a signal, already aborted!");this.signals.add(e),e.aborted?this.handleAborted(e):"function"==typeof e.addEventListener&&e.addEventListener("abort",()=>{this.handleAborted(e)})}handleAborted(e){this.signals.delete(e),0===this.signals.size&&this.abortController.abort()}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}}class s{constructor(){this.callbacks=new Set}addCallback(e=()=>{}){this.callbacks.add(e),this.currentMessage&&e(this.currentMessage)}callback(e){for(let t of(this.currentMessage=e,this.callbacks))t(e)}}class i{constructor({fill:e,cache:t}){if("function"!=typeof e)throw TypeError("must pass a fill function");if("object"!=typeof t)throw TypeError("must pass a cache object");if("function"!=typeof t.get||"function"!=typeof t.set||"function"!=typeof t.delete)throw TypeError("cache must implement get(key), set(key, val), and and delete(key)");this.cache=t,this.fillCallback=e}static isAbortException(e){return"AbortError"===e.name||"ERR_ABORTED"===e.code||"AbortError: aborted"===e.message||"Error: aborted"===e.message}evict(e,t){this.cache.get(e)===t&&this.cache.delete(e)}fill(e,t,r,n){let i=new a,o=new s;o.addCallback(n);let l={aborter:i,promise:this.fillCallback(t,i.signal,e=>{o.callback(e)}),settled:!1,statusReporter:o,get aborted(){return this.aborter.signal.aborted}};l.aborter.addSignal(r),l.aborter.signal.addEventListener("abort",()=>{l.settled||this.evict(e,l)}),l.promise.then(()=>{l.settled=!0},()=>{l.settled=!0,this.evict(e,l)}).catch(e=>{throw console.error(e),e}),this.cache.set(e,l)}static checkSinglePromise(e,t){function r(){if(t?.aborted)throw Object.assign(Error("aborted"),{code:"ERR_ABORTED"})}return e.then(e=>(r(),e),e=>{throw r(),e})}has(e){return this.cache.has(e)}get(e,t,r,n){if(!r&&t instanceof AbortSignal)throw TypeError("second get argument appears to be an AbortSignal, perhaps you meant to pass `null` for the fill data?");let a=this.cache.get(e);return a?a.aborted&&!a.settled?(this.evict(e,a),this.get(e,t,r,n)):a.settled?a.promise:(a.aborter.addSignal(r),a.statusReporter.addCallback(n),i.checkSinglePromise(a.promise,r)):(this.fill(e,t,r,n),i.checkSinglePromise(this.cache.get(e).promise,r))}delete(e){let t=this.cache.get(e);t&&(t.settled||t.aborter.abort(),this.cache.delete(e))}clear(){let e=this.cache.keys(),t=0;for(let r=e.next();!r.done;r=e.next())this.delete(r.value),t+=1;return t}}},37519:function(e,t,r){function n(e,t=0){let r=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;return((e[t+4]|e[t+5]<<8|e[t+6]<<16|e[t+7]<<24)>>>0)*4294967296+(r>>>0)}function a(e,t,r){let n=t[1],a=r?r[1]:1/0;return n<=e&&a>e?0:n<e?-1:1}r.d(t,{q5:function(){return u},Ri:function(){return c},y$:function(){return h}});class s{constructor({filehandle:e}){this.filehandle=e}_getIndex(){return this.index||(this.index=this._readIndex().catch(e=>{throw this.index=void 0,e})),this.index}async _readIndex(){let e=n(await this.filehandle.read(8,0));if(!e)return[[0,0]];let t=Array(e+1);t[0]=[0,0];let r=16*e;if(r>Number.MAX_SAFE_INTEGER)throw TypeError("integer overflow");let a=await this.filehandle.read(r,8);for(let r=0;r<e;r+=1){let e=n(a,16*r),s=n(a,16*r+8);t[r+1]=[e,s]}return t}async getLastBlock(){return(await this._getIndex()).at(-1)}async getRelevantBlocksForRead(e,t){let r=t+e;if(0===e)return[];let n=await this._getIndex(),s=[],i=0,o=n.length-1,l=Math.floor(n.length/2),c=a(t,n[l],n[l+1]);for(;0!==c;)c>0?o=l-1:c<0&&(i=l+1),c=a(t,n[l=Math.ceil((o-i)/2)+i],n[l+1]);s.push(n[l]);let h=l+1;for(;h<n.length&&(s.push(n[h]),!(n[h][1]>=r));h+=1);return s[s.length-1][1]<r&&s.push([]),s}}function i(e){let t=new Uint8Array(function(e){let t=0;for(let r of e)t+=r.length;return t}(e)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t}let{Z_SYNC_FLUSH:o,Inflate:l}=r(63624);async function c(e){try{let t,r;let n=0,a=[];do{let s=e.subarray(n);if(r=new l,{strm:t}=r,r.push(s,o),r.err)throw Error(r.msg);n+=t.next_in,a.push(r.result)}while(t.avail_in);return i(a)}catch(e){if(/incorrect header check/.exec(`${e}`))throw Error("problem decompressing block: incorrect gzip header check");throw e}}async function h(e,t,r){try{let n;let{minv:a,maxv:s}=t,c=a.blockPosition,h=a.dataPosition,u=[],d=[],f=[],g=0,p=!1;do{let t,i;let b=e.subarray(c-a.blockPosition),w=function(e,t){let r=t.subarray(0,Math.min(32,t.length)),n=0,a=r.length;for(let e=0;e<a;e++)n=(n<<5)-n+r[e]&4294967295;return`${e}_${n}`}(c,b),y=r?.get(w);if(y)t=y.buffer,i=y.nextIn,p=!0;else{let e=new l;if({strm:n}=e,e.push(b,o),e.err)throw Error(e.msg);t=e.result,i=n.next_in,p=!1,r?.set(w,{buffer:t,nextIn:i})}u.push(t);let m=t.length;d.push(c),f.push(h),1===u.length&&a.dataPosition&&(u[0]=u[0].subarray(a.dataPosition),m=u[0].length);let k=c;if(c+=i,h+=m,k>=s.blockPosition){u[g]=u[g].subarray(0,s.blockPosition===a.blockPosition?s.dataPosition-a.dataPosition+1:s.dataPosition+1),d.push(c),f.push(h);break}g++}while(p?c<e.length+a.blockPosition:n.avail_in);return{buffer:i(u),cpositions:d,dpositions:f}}catch(e){if(/incorrect header check/.exec(`${e}`))throw Error("problem decompressing block: incorrect gzip header check");throw e}}class u{constructor({filehandle:e,gziFilehandle:t}){this.filehandle=e,this.gzi=new s({filehandle:t})}async _readAndUncompressBlock(e,t){let r=t;r||(r=(await this.filehandle.stat()).size);let n=r-e;return c(await this.filehandle.read(n,e))}async read(e,t){let r=await this.gzi.getRelevantBlocksForRead(e,t),n=[];for(let a=0;a<r.length-1;a+=1){let s=await this._readAndUncompressBlock(r[a][0],r[a+1][0]),[,i]=r[a],o=i>=t?0:t-i,l=Math.min(t+e,i+s.length)-i;o>=0&&o<s.length&&n.push(s.subarray(o,l))}return i(n)}}},24295:function(e,t,r){r.d(t,{IB:function(){return l},P:function(){return o}});var n=r(37519),a=r(3549);function s(e,t){return e.offset+e.lineBytes*Math.floor(t/e.lineLength)+t%e.lineLength}async function i(e,t={}){return Object.fromEntries(new TextDecoder("utf8").decode(await e.readFile(t)).split(/\r?\n/).map(e=>e.trim()).filter(e=>!!e).map(e=>e.split("	")).map(e=>{if(e[0]?.startsWith(">"))throw Error("found > in sequence name, might have supplied FASTA file for the FASTA index");return[e[0],{name:e[0],length:+e[1],start:0,end:+e[1],offset:+e[2],lineLength:+e[3],lineBytes:+e[4]}]}))}class o{constructor({fasta:e,fai:t,path:r,faiPath:n}){if(e)this.fasta=e;else if(r)this.fasta=new a.S9(r);else throw Error("Need to pass filehandle for fasta or path to localfile");if(t)this.fai=t;else if(n)this.fai=new a.S9(n);else if(r)this.fai=new a.S9(`${r}.fai`);else throw Error("Need to pass filehandle for  or path to localfile")}async _getIndexes(e){return this.indexes||(this.indexes=i(this.fai,e).catch(e=>{throw this.indexes=void 0,e})),this.indexes}async getSequenceNames(e){return Object.keys(await this._getIndexes(e))}async getSequenceSizes(e){let t={};for(let r of Object.values(await this._getIndexes(e)))t[r.name]=r.length;return t}async getSequenceSize(e,t){let r=await this._getIndexes(t);return r[e]?.length}async hasReferenceSequence(e,t){return!!(await this._getIndexes(t))[e]}async getResiduesByName(e,t,r,n){let a=(await this._getIndexes(n))[e];return a?this._fetchFromIndexEntry(a,t,r,n):void 0}async getSequence(e,t,r,n){return this.getResiduesByName(e,t,r,n)}async _fetchFromIndexEntry(e,t=0,r,n){let a=r;if(t<0)throw TypeError("regionStart cannot be less than 0");if((void 0===a||a>e.length)&&(a=e.length),t>=a)return"";let i=s(e,t),o=s(e,a)-i;return new TextDecoder("utf8").decode(await this.fasta.read(o,i,n)).replace(/\s+/g,"")}}class l extends o{constructor({fasta:e,path:t,fai:r,faiPath:s,gzi:i,gziPath:o}){super({fasta:e,path:t,fai:r,faiPath:s}),e&&i?this.fasta=new n.q5({filehandle:e,gziFilehandle:i}):t&&o&&(this.fasta=new n.q5({filehandle:new a.S9(t),gziFilehandle:new a.S9(o)}))}}},3549:function(e,t,r){r.d(t,{S9:function(){return n}});class n{readFile(){throw Error("unimplemented")}read(){throw Error("unimplemented")}close(){throw Error("unimplemented")}}}}]);