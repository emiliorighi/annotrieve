"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[29],{10029:function(e,t,n){n.r(t),n.d(t,{default:function(){return h}});var a=n(19814),i=n(50611),s=n(77207),r=n(42382),l=n(61795),o=n(52427),c=n(80883);class h extends s.BaseFeatureDataAdapter{async configurePre(e){let t=this.getConf("vcfGzLocation"),n=this.getConf(["index","location"]),s=this.getConf(["index","indexType"]),r=(0,l.openLocation)(t,this.pluginManager),o="CSI"===s,c=new a.pC({filehandle:r,csiFilehandle:o?(0,l.openLocation)(n,this.pluginManager):void 0,tbiFilehandle:o?void 0:(0,l.openLocation)(n,this.pluginManager),chunkCacheSize:52428800});return{vcf:c,parser:new i.Z({header:await c.getHeader()})}}async configurePre2(){return this.configured||(this.configured=this.configurePre().catch(e=>{throw this.configured=void 0,e})),this.configured}async configure(e){let{statusCallback:t=()=>{}}=e||{};return(0,r.updateStatus)("Downloading index",t,()=>this.configurePre2())}async getRefNames(e={}){let{vcf:t}=await this.configure(e);return t.getReferenceSequenceNames(e)}async getHeader(e){let{vcf:t}=await this.configure(e);return t.getHeader()}async getMetadata(e){let{parser:t}=await this.configure(e);return t.getMetadata()}getFeatures(e,t={}){return(0,o.ObservableCreate)(async n=>{let{refName:a,start:i,end:s}=e,{statusCallback:l=()=>{}}=t,{vcf:o,parser:h}=await this.configure(t);await (0,r.updateStatus)("Downloading variants",l,()=>o.getLines(a,i,s,{lineCallback:(e,t)=>{n.next(new c.Z({variant:h.parseLine(e),parser:h,id:`${this.id}-vcf-${t}`}))},...t})),n.complete()},t.stopToken)}async getSources(){let e=this.getConf("samplesTsvLocation");if(""===e.uri||"/path/to/samples.tsv"===e.uri){let{parser:e}=await this.configure();return e.samples.map(e=>({name:e}))}{let t=(await (0,r.fetchAndMaybeUnzipText)((0,l.openLocation)(e,this.pluginManager))).split(/\n|\r\n|\r/),n=t[0].split("	"),{parser:a}=await this.configure(),i=t.slice(1).filter(e=>!!e).map(e=>{let[t,...a]=e.split("	");return{...Object.fromEntries(n.slice(1).map((e,t)=>[e,a[t]||""])),name:t}}),s=new Set(a.samples),o=new Set(i.map(e=>e.name)),c=[...o].filter(e=>!s.has(e)),h=[...s].filter(e=>!o.has(e));return c.length&&console.warn(`There are ${c.length} samples in metadata file (${i.length} lines) not in VCF (${a.samples.length} samples):`,(0,r.shorten2)(c.join(","))),h.length&&console.warn(`There are ${h.length} samples in VCF file (${a.samples.length} samples) not in metadata file (${i.length} lines):`,(0,r.shorten2)(h.map(e=>e).join(","))),i.filter(e=>s.has(e.name))}}}}}]);