"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{50501:function(e,t,n){n.r(t),n.d(t,{default:function(){return A}});var i=n(57437),s=n(2265),r=n(98833),l=n(90658),o=n(93618),a=n(37926),c=n(7934),d=n(47198),u=n(42382),p=n(47368),h=n(63168),x=n(17725),j=n(77639),g=n(17764),v=n(91904);let m=(0,d.observer)(function({model:e,children:t,handleClose:n}){let[l,o]=(0,s.useState)(""),[a,c]=(0,s.useState)(!1),[d,m]=(0,s.useState)(),[f,y]=(0,s.useState)("");return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(x.Z,{children:[t,(0,i.jsxs)("div",{children:[a?(0,i.jsxs)("div",{style:{padding:50},children:[(0,i.jsx)("span",{children:l||"Loading..."}),(0,i.jsx)(j.Z,{onClick:()=>{(0,p.stopStopToken)(f)},children:"Stop"})]}):null,d?(0,i.jsx)(r.ErrorMessage,{error:d}):null]})]}),(0,i.jsxs)(g.Z,{children:[(0,i.jsx)(j.Z,{variant:"contained",disabled:a,onClick:async()=>{try{m(void 0),o("Initializing"),c(!0);let t=(0,u.getContainingView)(e);if(!t.initialized)return;let{rpcManager:i}=(0,u.getSession)(e),{sourcesWithoutLayout:s,minorAlleleFrequencyFilter:r,lengthCutoffFilter:l,adapterConfig:a}=e;if(s){let n=(0,h.getRpcSessionId)(e),c=(0,p.createStopToken)();y(c);let d=await i.call(n,"MultiVariantClusterGenotypeMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:s,minorAlleleFrequencyFilter:r,lengthCutoffFilter:l,sessionId:n,adapterConfig:a,stopToken:c,statusCallback:e=>{o(e)}});e.setLayout(d.order.map(e=>{let t=s[e];if(!t)throw Error(`out of bounds at ${e}`);return t}))}n()}catch(t){!(0,u.isAbortException)(t)&&(0,v.isAlive)(e)&&(console.error(t),m(t))}finally{c(!1),o(""),y("")}},children:"Run clustering"}),(0,i.jsx)(j.Z,{variant:"contained",color:"secondary",onClick:()=>{n(),f&&(0,p.stopStopToken)(f)},children:"Cancel"})]})]})});var f=n(88654),y=n(31835),C=n(49211),b=n.n(C),k=n(12);let S=(0,n(3905).makeStyles)()(e=>({textAreaFont:{fontFamily:"Courier New"},mgap:{display:"flex",flexDirection:"column",gap:e.spacing(4)}})),w=(0,d.observer)(function({model:e,handleClose:t,children:n}){let{classes:d}=S(),[p,m]=(0,s.useState)(""),[C,w]=(0,s.useState)(),[Z,A]=(0,s.useState)(),[M,E]=(0,s.useState)(!1),[R,B]=(0,u.useLocalStorage)("cluster-showAdvanced",!1),[$,T]=(0,s.useState)("single");(0,s.useEffect)(()=>{(async()=>{try{A(void 0),w(void 0),E(!0);let t=(0,u.getContainingView)(e);if(!t.initialized)return;let{rpcManager:n}=(0,u.getSession)(e),{sourcesWithoutLayout:i,minorAlleleFrequencyFilter:s,lengthCutoffFilter:r,adapterConfig:l}=e,o=(0,h.getRpcSessionId)(e),a=await n.call(o,"MultiVariantGetGenotypeMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:i,minorAlleleFrequencyFilter:s,lengthCutoffFilter:r,sessionId:o,adapterConfig:l});w(a)}catch(t){!(0,u.isAbortException)(t)&&(0,v.isAlive)(e)&&(console.error(t),A(t))}finally{E(!1)}})()},[e]);let O=C?`inputMatrix<-matrix(c(${Object.values(C).map(e=>e.join(",")).join(",\n")}
),nrow=${Object.values(C).length},byrow=TRUE)
rownames(inputMatrix)<-c(${Object.keys(C).map(e=>`'${e}'`).join(",")})
resultClusters<-hclust(dist(inputMatrix), method='${$}')
cat(resultClusters$order,sep='\\n')`:void 0,D=C?Object.entries(C).map(([e,t])=>[e,...t].join("	")).join("\n"):void 0;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(x.Z,{children:[n,(0,i.jsxs)(f.Z,{style:{padding:16},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"16px"},children:[(0,i.jsx)(j.Z,{variant:"contained",onClick:()=>{(0,k.saveAs)(new Blob([O||""],{type:"text/plain;charset=utf-8"}),"cluster.R")},children:"Download Rscript"})," ","or"," ",(0,i.jsx)(j.Z,{variant:"contained",onClick:()=>{b()(O||"")},children:"Copy Rscript to clipboard"})," ","or"," ",(0,i.jsx)(j.Z,{variant:"contained",onClick:()=>{(0,k.saveAs)(new Blob([D||""],{type:"text/plain;charset=utf-8"}),"genotypes.tsv")},children:"Download TSV"}),(0,i.jsx)("div",{children:(0,i.jsx)(j.Z,{variant:"contained",onClick:()=>{B(!R)},children:R?"Hide advanced options":"Show advanced options"})})]}),R?(0,i.jsxs)("div",{children:[(0,i.jsx)(l.Z,{variant:"h6",children:"Advanced options"}),(0,i.jsx)(o.Z,{children:Object.entries({single:"Single",complete:"Complete"}).map(([e,t])=>(0,i.jsx)(a.Z,{control:(0,i.jsx)(c.Z,{checked:$===e,onChange:()=>{T(e)}}),label:t},e))})]}):null,O?(0,i.jsx)("div",{}):M?(0,i.jsx)(r.LoadingEllipses,{variant:"h6",title:"Generating genotype matrix"}):Z?(0,i.jsx)(r.ErrorMessage,{error:Z}):null]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(l.Z,{variant:"subtitle2",gutterBottom:!0,style:{marginTop:"16px"},children:"Clustering Results:"}),(0,i.jsx)(y.Z,{multiline:!0,fullWidth:!0,variant:"outlined",placeholder:"Paste results from Rscript here (sequence of numbers, one per line, specifying the new ordering)",rows:10,value:p,onChange:e=>{m(e.target.value)},slotProps:{input:{classes:{input:d.textAreaFont}}}})]})]})]}),(0,i.jsxs)(g.Z,{children:[(0,i.jsx)(j.Z,{variant:"contained",onClick:()=>{let{sourcesWithoutLayout:n}=e;if(n)try{e.setLayout(p.split("\n").map(e=>e.trim()).filter(e=>!!e).map(e=>+e).map(e=>{let t=n[e-1];if(!t)throw Error(`out of bounds at ${e}`);return t}))}catch(t){console.error(t),(0,u.getSession)(e).notifyError(`${t}`,t)}t()},children:"Apply clustering"}),(0,i.jsx)(j.Z,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"})]})]})});function Z({activeMode:e,setActiveMode:t}){return(0,i.jsxs)("div",{children:[(0,i.jsx)(l.Z,{style:{marginBottom:30},children:"This procedure will cluster the visible genotype data using hierarchical clustering"}),(0,i.jsx)(o.Z,{children:Object.entries({auto:(0,i.jsx)("div",{children:"Run in-app clustering (slower, particularly for large numbers of samples, uses JS implementation of hclust)"}),manual:(0,i.jsx)("div",{children:"Download R script to run clustering (faster, uses R implementation of hclust)"})}).map(([n,s])=>(0,i.jsx)(a.Z,{control:(0,i.jsx)(c.Z,{checked:e===n,onChange:()=>{t(n)}}),label:s},n))})]})}var A=(0,d.observer)(function({model:e,handleClose:t}){let[n,l]=(0,s.useState)("auto");return(0,i.jsx)(r.Dialog,{open:!0,title:"Cluster by genotype",onClose:(e,n)=>{"backdropClick"!==n&&t()},children:"auto"===n?(0,i.jsx)(m,{model:e,handleClose:t,children:(0,i.jsx)(Z,{activeMode:n,setActiveMode:l})}):(0,i.jsx)(w,{model:e,handleClose:t,children:(0,i.jsx)(Z,{activeMode:n,setActiveMode:l})})})})}}]);