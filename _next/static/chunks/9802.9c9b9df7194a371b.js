"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9802],{89802:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var r=a(99115),s=a(33224),n=a(77207),i=a(42382),u=a(61795),d=a(52427),o=a(47358),l=a(15097),c=a(91666);class f extends n.BaseFeatureDataAdapter{async configurePre(e){let t=this.pluginManager,a=new r.Q({filehandle:(0,u.openLocation)(this.getConf("bigBedLocation"),t)}),n=await a.getHeader(e),i=new s.Z({autoSql:n.autoSql});return{bigbed:a,header:n,parser:i}}async configure(e){return this.cachedP||(this.cachedP=this.configurePre(e).catch(e=>{throw this.cachedP=void 0,e})),this.cachedP}async getRefNames(e){let{header:t}=await this.configure(e);return Object.keys(t.refsByName)}async getRefNameAliases(e){let{header:t}=await this.configure(e);return(await Promise.all(Object.keys(t.refsByName).map(async e=>(await (0,o.z)(this.getFeatures({assemblyName:"",refName:e,start:0,end:1}).pipe((0,l.q)())))[0]))).map(e=>e.toJSON()).map(e=>({refName:e.ucsc,aliases:[e.ncbi,e.refseq,e.genbank],override:!0}))}async getData(){let e=await this.getRefNames(),t=[];for(let a of e){let e=await (0,o.z)(this.getFeatures({assemblyName:"unknown",refName:a,start:0,end:Number.MAX_SAFE_INTEGER}).pipe((0,l.q)()));t.push(e)}return t.flat()}async getHeader(e){let{parser:t,header:a}=await this.configure(e),{version:r,fileType:s}=a,{fields:n,...i}=t.autoSql;return{version:r,fileType:s,autoSql:i,fields:await this.getMetadata(e)}}async getMetadata(e){let{parser:t}=await this.configure(e),{fields:a}=t.autoSql;return Object.fromEntries(a.map(({name:e,comment:t})=>[e,t]))}async getFeaturesHelper({query:e,opts:t,observer:a,allowRedispatch:r,originalQuery:s=e}){let{statusCallback:n=()=>{}}=t,u=this.getConf("scoreColumn"),d=this.getConf("aggregateField"),{parser:o,bigbed:l}=await (0,i.updateStatus)("Downloading header",n,()=>this.configure(t)),f=await (0,i.updateStatus)("Downloading features",n,()=>l.getFeatures(e.refName,e.start,e.end,{basesPerSpan:e.end-e.start}));await (0,i.updateStatus)("Processing features",n,async()=>{var n;let l={},h=[];if(f.some(e=>void 0===e.uniqueId))throw Error("found uniqueId undefined");for(let t of f){let r=[e.refName,`${t.start}`,`${t.end}`,...(null===(n=t.rest)||void 0===n?void 0:n.split("	"))||[]],f=o.parseLine(r,{uniqueId:t.uniqueId}),m=f[d],p=m&&"none"!==m;p&&!l[m]&&(l[m]=[]);let{uniqueId:g,type:w,chrom:N,chromStart:y,chromEnd:b,description:I,chromStarts:q,blockStarts:S,blockSizes:v,score:F,blockCount:k,thickStart:E,thickEnd:P,strand:C,...$}=f,_=(0,c.My)({...$,scoreColumn:u,splitLine:r,parser:o,uniqueId:g,start:t.start,end:t.end,refName:e.refName});p?(l[m].push(_),h.push(_)):(0,i.doesIntersect2)(_.start,_.end,s.start,s.end)&&a.next(new i.SimpleFeature({id:`${this.id}-${g}`,data:_}))}if(r&&h.length){let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let e of h)e.start<r&&(r=e.start),e.end>s&&(s=e.end);if(s>e.end||r<e.start){await this.getFeaturesHelper({query:{...e,start:r-5e5,end:s+5e5},opts:t,observer:a,allowRedispatch:!1,originalQuery:e});return}}Object.entries(l).map(([t,r])=>{var n,u,d;let o=(0,i.min)(r.map(e=>e.start)),l=(0,i.max)(r.map(e=>e.end));if((0,i.doesIntersect2)(o,l,s.start,s.end)){let s=r.sort((e,t)=>e.uniqueId.localeCompare(t.uniqueId));if(s.some((e,t)=>s.some((a,r)=>t!==r&&(0,i.doesIntersect2)(e.start,e.end,a.start,a.end))))a.next(new i.SimpleFeature({id:`${this.id}-${null===(n=s[0])||void 0===n?void 0:n.uniqueId}-parent`,data:{type:"gene",subfeatures:s,strand:(null===(u=s[0])||void 0===u?void 0:u.strand)||1,name:t,start:o,end:l,refName:e.refName}}));else for(let r of s)a.next(new i.SimpleFeature({id:`${this.id}-${r.uniqueId}-parent`,data:{type:"gene",subfeatures:[r],strand:(null===(d=s[0])||void 0===d?void 0:d.strand)||1,name:t,start:r.start,end:r.end,refName:e.refName}}))}})}),a.complete()}getFeatures(e,t={}){return(0,d.ObservableCreate)(async a=>{try{await this.getFeaturesHelper({query:{...e,start:e.start,end:e.end},opts:t,observer:a,allowRedispatch:!0})}catch(e){a.error(e)}},t.stopToken)}}}}]);