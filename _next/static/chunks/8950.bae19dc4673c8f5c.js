"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8950],{56785:function(e,t,a){a.r(t),a.d(t,{default:function(){return i.G}});var i=a(80662)},80662:function(e,t,a){a.d(t,{G:function(){return b},sH:function(){return C}});var i=a(57437),n=a(2265),o=a(98833),r=a(17725),s=a(17764),l=a(77639),c=a(47198),d=a(91904),f=a(37926),p=a(793);let m=(0,a(3905).makeStyles)()({block:{display:"block"}});function u({checked:e,disabled:t,label:a,onChange:n}){let{classes:o}=m();return(0,i.jsx)(f.Z,{disabled:t,className:o.block,control:(0,i.jsx)(p.Z,{checked:e,onChange:n}),label:a})}var w=a(42382),v=a(50611);function h({feature:e,assembly:t}){var a;let i=null===(a=e.get("ALT"))||void 0===a?void 0:a[0],n=i?(0,v.I)(i):void 0,o=e.get("start"),r=e.get("refName"),s=e=>t.getCanonicalRefName(e)||e;if("<TRA>"===i){let t=e.get("INFO");return{pos:o,refName:s(r),mateRefName:s(t.CHR2[0]),matePos:t.END[0]-1}}if(null==n?void 0:n.MatePosition){let e=n.MatePosition.split(":");return{pos:o,refName:s(r),mateRefName:s(e[0]),matePos:+e[1]-1}}if(!e.get("mate"))return{pos:o,refName:s(r),mateRefName:s(r),matePos:e.get("end")};{let t=e.get("mate");return{pos:o,refName:s(r),mateRefName:s(t.refName),matePos:t.start}}}function g(e){return e.map(({id:e,displays:t,...a})=>({...a,displays:t.map(({id:e,...t})=>t)}))}function y(e){return`${e.get("name")||e.get("id")||"breakend"} split detail`}async function k({stableViewId:e,feature:t,assemblyName:a,session:i,mirror:n,tracks:o=[]}){let{assemblyManager:r}=i,s=await r.waitForAssembly(a);if(!s)throw Error(`assembly ${a} not found`);let{refName:l,pos:c,mateRefName:d,matePos:f}=h({feature:t,assembly:s}),p=i.views.find(t=>t.id===e);p||(p=i.addView("BreakpointSplitView",{id:e,type:"BreakpointSplitView",displayName:y(t),views:[{type:"LinearGenomeView",hideHeader:!0,tracks:g(o)},{type:"LinearGenomeView",hideHeader:!0,tracks:g(n?[...o].reverse():o)}]})),p.setDisplayName(y(t));let m=s.regions.find(e=>e.refName===l),u=s.regions.find(e=>e.refName===d);if(!m||!u)throw Error("can't find regions");await Promise.all([p.views[0].navToLocations([{refName:l,start:m.start,end:c,assemblyName:a},{refName:l,start:c+1,end:m.end,assemblyName:a}]),p.views[1].navToLocations([{refName:d,start:u.start,end:f,assemblyName:a},{refName:d,start:f+1,end:u.end,assemblyName:a}])]),await (0,w.when)(()=>p.views[1].initialized&&p.views[0].initialized),p.views[1].zoomTo(10),p.views[0].zoomTo(10),p.views[1].centerAt(f,d),p.views[0].centerAt(c,l)}var b=(0,c.observer)(function({session:e,handleClose:t,feature:a,assemblyName:c,stableViewId:f,view:p}){let[m,w]=(0,n.useState)(!0),[v,h]=(0,n.useState)(!0);return(0,i.jsxs)(o.Dialog,{open:!0,onClose:t,title:"Multi-level breakpoint split view options",children:[(0,i.jsxs)(r.Z,{children:[(0,i.jsx)("div",{children:"Launch multi-level breakpoint split view"}),p?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u,{checked:m,label:"Copy tracks into the new view",onChange:e=>{w(e.target.checked)}}),m?(0,i.jsx)(u,{checked:v,disabled:!m,label:"Mirror the copied tracks (only available if copying tracks and using two level)",onChange:e=>{h(e.target.checked)}}):null]}):null]}),(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(l.Z,{onClick:()=>{(async()=>{try{await k({stableViewId:f,session:e,tracks:m&&p?(0,d.getSnapshot)(p.tracks):[],mirror:v,feature:a,assemblyName:c})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),t()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),(0,i.jsx)(l.Z,{color:"secondary",variant:"contained",onClick:()=>{t()},children:"Cancel"})]})]})}),N=a(31835);async function x({stableViewId:e,feature:t,assemblyName:a,session:i,tracks:n,windowSize:o=0,focusOnBreakends:r}){var s;let{snap:l,coverage:c}=r?function({feature:e,session:t,assemblyName:a,windowSize:i=0}){let{assemblyManager:n}=t,o=n.get(a);if(!o)throw Error(`assembly ${a} not found`);if(!o.regions)throw Error(`assembly ${a} regions not loaded`);let r=h({feature:e,assembly:o}),{refName:s,mateRefName:l}=r,c=o.regions.find(e=>e.refName===s),d=o.regions.find(e=>e.refName===l);return{coverage:r,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:(0,w.gatherOverlaps)([{...c,end:r.pos+i,assemblyName:a},{...d,start:r.matePos-i,assemblyName:a}])}],displayName:y(e)}}}({feature:t,assemblyName:a,session:i,windowSize:o}):function({feature:e,session:t,assemblyName:a}){let{assemblyManager:i}=t,n=i.get(a);if(!n)throw Error(`assembly ${a} not found`);if(!n.regions)throw Error(`assembly ${a} regions not loaded`);let o=h({feature:e,assembly:n}),{refName:r,mateRefName:s}=o,l=n.regions.find(e=>e.refName===r),c=n.regions.find(e=>e.refName===s);return{coverage:o,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:(0,w.gatherOverlaps)([{...l,assemblyName:a},{...c,assemblyName:a}])}],displayName:y(e)}}}({feature:t,assemblyName:a,session:i}),{refName:f,pos:p,mateRefName:m,matePos:u}=c,v=i.views.find(t=>t.id===e);v?(null===(s=v.views[0])||void 0===s||s.setDisplayedRegions(l.views[0].displayedRegions),v.setDisplayName(l.displayName)):v=i.addView("BreakpointSplitView",{...l,views:[{...l.views[0],tracks:n?g((0,d.getSnapshot)(n)):[]}]});let k=v.views[0];await (0,w.when)(()=>k.initialized);let b=k.bpToPx({coord:Math.max(0,p-o),refName:f}),N=k.bpToPx({coord:u+o,refName:m});b&&N?k.moveTo({...b,offset:b.offsetPx},{...N,offset:N.offsetPx}):(0,w.getSession)(k).notify("Unable to navigate to breakpoint")}var C=(0,c.observer)(function({session:e,handleClose:t,feature:a,stableViewId:c,assemblyName:d,view:f}){let[p,m]=(0,n.useState)(!0),[v,h]=(0,n.useState)(!0),[g,y]=(0,w.useLocalStorage)("breakpointWindowSize","5000");return(0,i.jsxs)(o.Dialog,{open:!0,onClose:t,title:"Single-level breakpoint split view options",children:[(0,i.jsxs)(r.Z,{children:[f?(0,i.jsx)(u,{checked:p,label:"Copy tracks into the new view",onChange:e=>{m(e.target.checked)}}):null,(0,i.jsx)(u,{checked:p,label:"Focus on breakends",onChange:e=>{h(e.target.checked)}}),(0,i.jsx)(N.Z,{label:"Window size (bp)",value:g,onChange:e=>{y(e.target.value)}})]}),(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(l.Z,{onClick:()=>{(async()=>{try{let{assemblyManager:t}=e;if(!await t.waitForAssembly(d))throw Error(`assembly ${d} not found`);await x({feature:a,assemblyName:d,focusOnBreakends:v,session:e,stableViewId:c,tracks:null==f?void 0:f.tracks,windowSize:+g||0})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),t()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),(0,i.jsx)(l.Z,{color:"secondary",variant:"contained",onClick:()=>{t()},children:"Cancel"})]})]})})}}]);